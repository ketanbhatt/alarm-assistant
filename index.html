<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Alarm Assitant for Voice Assistants</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
</head>
<style type="text/css">
	html,
	body {
		height: 100%;
	}

	body {
		display: flex;
		align-items: center;
		padding-top: 40px;
		padding-bottom: 40px;
		background-color: #f5f5f5;
	}

	.form-alarm {
		max-width: 330px;
		padding: 15px;
	}

	.form-alarm .form-floating:focus-within {
		z-index: 2;
	}

	#bot {
		margin-bottom: -1px;
		border-bottom-right-radius: 0;
		border-bottom-left-radius: 0;
	}

	#startTime, #endTime {
		margin-bottom: -1px;	
		border-radius: 0;
	}

	#interval {
		border-top-left-radius: 0;
		border-top-right-radius: 0;
	}

</style>
<body class="text-center">
	<main class="form-alarm w-100 m-auto">
		<form onsubmit="setAllAlarms(event)">
			<h1 class="h3 mb-3 fw-normal">Stop talking to your bots!</h1>
			<p class="mb-3 text-muted">Let them talk to each other. Set multiple alarms without speaking!</p>

			<div class="form-floating">
				<select class="form-select" name="bot" id="bot">
					<option selected value="hey google">Google</option>
					<option value="hey siri">Siri</option>
					<option value="alexa">Alexa</option>
					<option value="hey cortana">Cortana</option>
				</select>
				<label for="bot">Your bot</label>
			</div>

			<div class="form-floating">
				<input type="text" class="form-control" id="startTime" value="6 00 AM">
				<label for="startTime">Start Time</label>
			</div>
			<div class="form-floating">
				<input type="text" class="form-control" id="endTime" value="7 00 AM">
				<label for="endTime">End Time</label>
			</div>
			<div class="form-floating">
				<input type="number" class="form-control" id="interval" value=10>
				<label for="interval">Interval in Minutes</label>
			</div>

			<button class="mt-2 w-100 btn btn-lg btn-success" id="submitBtn" type="submit">Press to set alarms!</button>

		</form>
	</main>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js" integrity="sha384-mQ93GR66B00ZXjt0YO5KlohRA5SY2XofN4zfuZxLkoj1gXtW8ANNCe9d5Y3eG5eD" crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/luxon@3.2.1/build/global/luxon.min.js" integrity="sha256-eTuW4qNdO+s5QEVrZ6g02eMzgyEZmLLuaUscvGF8/t0=" crossorigin="anonymous"></script>

	<script type="text/javascript">
		function getUtterance(text) {
			let utterance = new SpeechSynthesisUtterance(text);
			utterance.rate = 0.8;
			return utterance
		}

		function setAlarm(countdown, timeStr) {
			var bot = document.getElementById("bot").value;

			setTimeout(function () {
				console.log("Invoking assistant: " + bot)
				speechSynthesis.speak(getUtterance(bot));
			}, countdown + 1000);

			setTimeout(function () {
				console.log("Setting alarm for " + timeStr)
				speechSynthesis.speak(getUtterance("Set alarm for " + timeStr));
			}, countdown + 3000);

			return countdown + 3000
		}

		function getTimeStrs() {
			var DateTime = luxon.DateTime;
			let startTimeStr = document.getElementById("startTime").value;
			let endTimeStr = document.getElementById("endTime").value;
			let interval = Number(document.getElementById("interval").value);

			let startTime = DateTime.fromFormat(startTimeStr, "h mm a")
			let endTime = DateTime.fromFormat(endTimeStr, "h mm a")

			if (startTime.invalid != null) {
				alert("Woops! There is some problem with the start time: " + startTime.invalid.toMessage())
			}

			if (endTime.invalid != null) {
				alert("Woops! There is some problem with the end time: " + endTime.invalid.toMessage())
			}

			var timeStrs = [];
			var alarmTime = startTime;
			while (alarmTime <= endTime) {
				timeStrs.push(alarmTime.toFormat("h mm a"));
				alarmTime = alarmTime.plus({minutes: interval})
			}

			if (timeStrs.length < 1) { 
				alert("Woops, check your times. We couldn't find any times to set the alarms") 
			}

			if (timeStrs.length > 10) {
				alert("More than 10 alarms are not good for your mental health. Are you okay bruh!?")
			}

			return timeStrs
		}

		function setAllAlarms(event) {
			event.preventDefault();
			document.getElementById("submitBtn").disabled = true;
			let times = getTimeStrs();
			let countdown = 0
			times.forEach((timeStr) => {
				countdown = setAlarm(countdown, timeStr);
				countdown += 9000
			})
		}		
	</script>
</body>
</html>